<div *ngIf="isLoading" class="loading-overlay">
  <div class="spinner"></div>
</div>
<!-- Lista de pagos pendientes -->
<table class="table">
  <thead>
    <tr>
      <th>ID</th>
      <th>Usuario</th>
      <th>Cédula</th>
      <th>Teléfono</th>
      <th>Email</th>
      <th>Monto</th>
      <th>Método</th>
      <th>Referencia</th>
      <th>Fecha Pago</th>
      <th>Detalles Pago</th>
      <th>Estado</th>
      <th>Acciones</th>
    </tr>
  </thead>
  <tbody>
    <tr *ngFor="let payment of pendingPayments">
      <td>{{ payment.id }}</td>
      <td>{{ payment.user.name }}</td>
      <td>{{ payment.cedula }}</td>
      <td>{{ payment.phone }}</td>
      <td>{{ payment.email }}</td>
      <td>{{ payment.amount | currency }}</td>
      <td>{{ getPaymentMethodName(payment.paymentMethod) }}</td>
      <td>{{ payment.reference || 'N/A' }}</td>
      <td>{{ payment.paymentDate | date:'dd/MM/yyyy HH:mm' }}</td>
      <td>
        <div *ngIf="payment.paymentDetails">
          <div *ngFor="let detail of parsePaymentDetails(payment.paymentDetails) | keyvalue">
            {{ detail.key }}: {{ detail.value }}
          </div>
        </div>
      </td>
      <td [class.text-success]="payment.status === 'PAGADO'" 
          [class.text-warning]="payment.status === 'PENDIENTE'">
        {{ payment.status }}
      </td>
      <td>
        <button *ngIf="payment.status === 'PENDIENTE'" 
                (click)="openPaymentModal(payment)">
          Pagar
        </button>
        <span *ngIf="payment.status === 'PAGADO'">✅</span>
      </td>
    </tr>
  </tbody>
</table>

<!-- Modal de pago -->
<div class="modal" *ngIf="selectedPayment">
  <div class="modal-content">
    <h3>Registrar Pago</h3>
    <p>Usuario: {{ selectedPayment.user.name }}</p>
    <p>Monto: {{ selectedPayment.amount | currency }}</p>
    
    <input type="text" [(ngModel)]="reference" placeholder="Referencia de pago" required>
    
    <div class="modal-actions">
      <button (click)="submitPayment()" [disabled]="!reference">Confirmar</button>
      <button class="btn-cancel" (click)="selectedPayment = null">Cancelar</button>
    </div>
  </div>
</div>

<div *ngIf="errorMessage" class="error-message">{{ errorMessage }}</div>
<div *ngIf="successMessage" class="success-message">{{ successMessage }}</div>