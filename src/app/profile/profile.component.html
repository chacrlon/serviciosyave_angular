<div class="profile-container" [formGroup]="registrationForm">
  
  <!-- Paso 1: Información Personal -->
  <div *ngIf="currentStep === 1" class="step-section">
    <h2>Información Personal</h2>

    <!-- Sección de Mapa -->
  <div *ngIf="currentStep === 1" class="map-container">
    <div leaflet 
         [leafletOptions]="mapOptions" 
         (leafletClick)="onMapClick($event)">
    </div>
  </div>

    <!-- Coordenadas y Radio -->
    <div *ngIf="selectedLatitude && selectedLongitude" class="form-group">
      <p>Coordenadas seleccionadas: {{ selectedLatitude | number:'1.4-4' }}, {{ selectedLongitude | number:'1.4-4' }}</p>
    </div>
    
    <div class="form-group">
      <label>Radio de Cobertura (km):</label>
      <input type="number" formControlName="coverageRadius" min="1">
    </div>

    <!-- Información Básica -->
    <div class="form-group">
      <label>Nombre Completo:</label>
      <i class="fas fa-info-circle" title="Ingrese su nombre completo tal como aparece en su documento de identidad."></i>
      <input type="text" formControlName="fullName">
      <div *ngIf="registrationForm.get('fullName')?.invalid" class="error-message">
        Nombre requerido
      </div>
    </div>

    <!-- Documentos de Identidad -->
    <div class="form-row">
      <div class="form-group">
        <label>DNI Frente:</label>
        <i class="fas fa-info-circle" title="Suba una imagen clara del frente de su documento de identidad."></i>
        <input type="file" (change)="onFileSelected($event, 'dniFront')" accept="image/*" required>
        <img *ngIf="dniFrontUrl" [src]="dniFrontUrl" class="preview-image">
        <div *ngIf="registrationForm.get('dniFront')?.invalid" class="error-message">
          Documento requerido
        </div>
      </div>
      
      <div class="form-group">
        <label>DNI Dorso:</label>
        <i class="fas fa-info-circle" title="Suba una imagen clara del dorso de su documento de identidad."></i>
        <input type="file" (change)="onFileSelected($event, 'dniBack')" accept="image/*" required>
        <img *ngIf="dniBackUrl" [src]="dniBackUrl" class="preview-image">
        <div *ngIf="registrationForm.get('dniBack')?.invalid" class="error-message">
          Documento requerido
        </div>
      </div>
    </div>

    <!-- Selfie y Foto de Perfil -->
    <div class="form-group">
      <label>Selfie con DNI:</label>
      <i class="fas fa-info-circle" title="Suba una selfie sosteniendo su documento de identidad."></i>
      <input type="file" (change)="onFileSelected($event, 'selfie')" accept="image/*" required>
      <img *ngIf="selfieUrl" [src]="selfieUrl" class="preview-image">
      <div *ngIf="registrationForm.get('selfie')?.invalid" class="error-message">
        Selfie requerida
      </div>
    </div>

    <div class="form-group">
      <label>Foto de perfil:</label>
      <i class="fas fa-info-circle" title="Suba una imagen clara de su rostro para su perfil."></i>
      <input type="file" (change)="onFileSelected($event, 'profilePicture')" accept="image/*" required>
      <img *ngIf="profilePictureUrl" [src]="profilePictureUrl" class="preview-image">
      <div *ngIf="registrationForm.get('profilePicture')?.invalid" class="error-message">
        Campo obligatorio
      </div>
    </div>
  </div>

  <!-- Paso 2: Información Profesional -->
  <div *ngIf="currentStep === 2" class="step-section">
    <h2>Información Profesional</h2>

    <!-- Especializaciones -->
<div *ngFor="let subcategory of subcategories"> <!-- Usa subcategories -->
  <label>
    <input type="checkbox" 
           [value]="subcategory.id" 
           (change)="onSubcategoryChange($event, subcategory.id)">
    {{ subcategory.name }}
  </label>
</div>

    <!-- Experiencia Profesional -->
    <div class="form-group">
      <label>Profesión:</label>
      <i class="fas fa-info-circle" title="Ingrese su profesión u ocupación principal."></i>
      <input type="text" formControlName="profession">
      <div *ngIf="registrationForm.get('profession')?.invalid" class="error-message">
        Campo obligatorio
      </div>
    </div>

    <div class="form-group">
      <label>Años de Experiencia:</label>
      <i class="fas fa-info-circle" title="Ingrese el número de años de experiencia en su campo profesional."></i>
      <input type="number" formControlName="yearsOfExperience">
      <div *ngIf="registrationForm.get('yearsOfExperience')?.invalid" class="error-message">
        Valor mínimo: 0
      </div>
    </div>

    <!-- Descripción y Documentos -->
    <div class="form-group">
      <label>Descripción de Servicios:</label>
      <i class="fas fa-info-circle" title="Describa los servicios que ofrece y sus habilidades principales."></i>
      <textarea formControlName="skillsDescription" rows="4"></textarea>
      <div *ngIf="registrationForm.get('skillsDescription')?.invalid" class="error-message">
        Descripción requerida
      </div>
    </div>

    <div class="form-group">
      <label>Título Universitario:</label>
      <i class="fas fa-info-circle" title="Suba una imagen o PDF de su título universitario."></i>
      <input type="file" (change)="onFileSelected($event, 'universityTitle')" accept="image/*,.pdf" required>
      <div *ngIf="registrationForm.get('universityTitle')?.invalid" class="error-message">
        Documento requerido
      </div>
    </div>

    <div class="form-group">
      <label>Certificaciones Adicionales (máx. 3):</label>
      <i class="fas fa-info-circle" title="Suba hasta 3 imágenes o PDFs de otras certificaciones relevantes."></i>
      <input type="file" (change)="onFileSelected($event, 'certifications')" accept="image/*,.pdf" multiple>
    </div>

    <!-- Galería de Trabajos -->
    <div class="form-group">
      <label>Imágenes de trabajos anteriores:</label>
      <i class="fas fa-info-circle" title="Suba imágenes de trabajos anteriores que desee mostrar en su galería."></i>
      <input type="file" [multiple]="true" (change)="onFileSelected($event, 'galleryImages')" accept="image/*" multiple>
      <div class="gallery-preview">
        <img *ngFor="let img of galleryImageUrls" [src]="img" class="gallery-image">
      </div>
    </div>
  </div>

  <!-- Navegación y Mensajes -->
  <div class="navigation-buttons">
    <button *ngIf="currentStep > 1" 
            type="button" 
            class="btn-previous" 
            (click)="previousStep()">
      Anterior
    </button>
    
    <button *ngIf="currentStep < totalSteps"
            type="button"
            class="btn-next"
            (click)="nextStep()"
            [disabled]="!isStepValid(currentStep)">
      Siguiente
    </button>
    
    <button *ngIf="currentStep === totalSteps"
            type="button"
            class="btn-submit"
            (click)="saveProfile()"
            [disabled]="isLoading">
      {{ isLoading ? 'Guardando...' : 'Finalizar Registro' }}
    </button>
  </div>

  <div *ngIf="errorMessage" class="error-message">
    {{ errorMessage }}
  </div>
</div>